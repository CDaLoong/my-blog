(function(e){function n(n){for(var a,o,i=n[0],l=n[1],r=n[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);m&&m(n);while(p.length)p.shift()();return c.push.apply(c,r||[]),t()}function t(){for(var e,n=0;n<c.length;n++){for(var t=c[n],a=!0,o=1;o<t.length;o++){var i=t[o];0!==s[i]&&(a=!1)}a&&(c.splice(n--,1),e=l(l.s=t[0]))}return e}var a={},o={app:0},s={app:0},c=[];function i(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-05050cca":"a0f255b5","chunk-0b374aa2":"fa13f859","chunk-26008e92":"904b907b","chunk-27a975d0":"dd6973b1","chunk-2d0a4d73":"0ca7ee38","chunk-2d0d6561":"977c44a5","chunk-5190cc94":"96fda907","chunk-529dd1de":"241e39a4","chunk-52f80f1c":"75572e90","chunk-5fcbbc7e":"1b50b7ec","chunk-e4cda8ea":"eaf9f4aa"}[e]+".js"}function l(n){if(a[n])return a[n].exports;var t=a[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,l),t.l=!0,t.exports}l.e=function(e){var n=[],t={"chunk-05050cca":1,"chunk-0b374aa2":1,"chunk-26008e92":1,"chunk-27a975d0":1,"chunk-5190cc94":1,"chunk-529dd1de":1,"chunk-52f80f1c":1,"chunk-5fcbbc7e":1,"chunk-e4cda8ea":1};o[e]?n.push(o[e]):0!==o[e]&&t[e]&&n.push(o[e]=new Promise((function(n,t){for(var a="css/"+({}[e]||e)+"."+{"chunk-05050cca":"bfc6470c","chunk-0b374aa2":"9b39440b","chunk-26008e92":"7131a82c","chunk-27a975d0":"30d9d30f","chunk-2d0a4d73":"31d6cfe0","chunk-2d0d6561":"31d6cfe0","chunk-5190cc94":"a8a9ce54","chunk-529dd1de":"c5cdc81e","chunk-52f80f1c":"f0a1ea04","chunk-5fcbbc7e":"1934a262","chunk-e4cda8ea":"31cb6099"}[e]+".css",s=l.p+a,c=document.getElementsByTagName("link"),i=0;i<c.length;i++){var r=c[i],d=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(d===a||d===s))return n()}var p=document.getElementsByTagName("style");for(i=0;i<p.length;i++){r=p[i],d=r.getAttribute("data-href");if(d===a||d===s)return n()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=n,m.onerror=function(n){var a=n&&n.target&&n.target.src||s,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.request=a,delete o[e],m.parentNode.removeChild(m),t(c)},m.href=s;var u=document.getElementsByTagName("head")[0];u.appendChild(m)})).then((function(){o[e]=0})));var a=s[e];if(0!==a)if(a)n.push(a[2]);else{var c=new Promise((function(n,t){a=s[e]=[n,t]}));n.push(a[2]=c);var r,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=i(e);var p=new Error;r=function(n){d.onerror=d.onload=null,clearTimeout(m);var t=s[e];if(0!==t){if(t){var a=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;p.message="Loading chunk "+e+" failed.\n("+a+": "+o+")",p.name="ChunkLoadError",p.type=a,p.request=o,t[1](p)}s[e]=void 0}};var m=setTimeout((function(){r({type:"timeout",target:d})}),12e4);d.onerror=d.onload=r,document.head.appendChild(d)}return Promise.all(n)},l.m=e,l.c=a,l.d=function(e,n,t){l.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,n){if(1&n&&(e=l(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(l.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)l.d(t,a,function(n){return e[n]}.bind(null,a));return t},l.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(n,"a",n),n},l.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},l.p="/",l.oe=function(e){throw console.error(e),e};var r=window["webpackJsonp"]=window["webpackJsonp"]||[],d=r.push.bind(r);r.push=n,r=r.slice();for(var p=0;p<r.length;p++)n(r[p]);var m=d;c.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"02e6":function(e,n,t){},1435:function(e,n,t){},3929:function(e,n,t){},"399e":function(e,n,t){},"47dc":function(e,n,t){e.exports=t.p+"img/loading.6cc04d10.svg"},5136:function(e,n,t){"use strict";t("632b")},"55a8":function(e,n,t){"use strict";t("3929")},"56d7":function(e,n,t){"use strict";t.r(n);var a=t("2b0e"),o=function(){var e=this,n=e._self._c;return n("div",{attrs:{id:"app"}},[n("blog-main")],1)},s=[],c=function(){var e=this,n=e._self._c;return n("div",{staticClass:"main"},[n("div",{staticClass:"nav-box",class:{home:e.isHome}},[n("router-link",{attrs:{to:{name:"HomePage"}}},[n("div",{staticClass:"logo"})]),n("div",{staticClass:"nav-list"},e._l(e.navList,(function(t){return n("router-link",{key:t.url,attrs:{to:{name:t.name}}},[e._v(" "+e._s(t.title)+" ")])})),1),n("div",{staticClass:"nav-btn",on:{click:function(n){e.btnShow=!0}}},[n("icon",{attrs:{type:"list"}})],1),n("div",{staticClass:"btn-box",class:{show:e.btnShow}},[n("div",{staticClass:"btn-logo"},[n("router-link",{attrs:{to:{name:"HomePage"}}},[n("div",{staticClass:"logo"})])],1),n("div",{staticClass:"btn-close",on:{click:function(n){e.btnShow=!1}}},[n("icon",{attrs:{type:"close"}})],1),n("div",{ref:"nav",staticClass:"btn-list"},e._l(e.navList,(function(t){return n("router-link",{key:t.url,attrs:{to:{name:t.name}}},[e._v(" "+e._s(t.title)+" ")])})),1)])],1),n("div",{staticClass:"container",class:{containerTop:e.isHome}},[n("keep-alive",[n("router-view")],1)],1)])},i=[],l={name:"BlogMain",data(){return{btnShow:!1,navList:[{name:"HomePage",title:"Home",exact:!0},{name:"Blog",title:"Blog",exact:!0},{name:"Essay",title:"Essay",exact:!0},{name:"WishingWall",title:"WishingWall",exact:!0},{name:"About",title:"About",exact:!0}]}},computed:{isHome(){return"/"===this.$route.path}},created(){},methods:{},mounted(){},watch:{}},r=l,d=(t("5136"),t("2877")),p=Object(d["a"])(r,c,i,!1,null,"b0e96844",null),m=p.exports,u={name:"App",components:{BlogMain:m}},h=u,g=(t("6893"),Object(d["a"])(h,o,s,!1,null,"78f909b4",null)),f=g.exports,b=t("8c4f"),y=function(){var e=this;e._self._c;return e._m(0)},j=[function(){var e=this,n=e._self._c;return n("div",{staticClass:"not-found-container"},[n("img",{attrs:{src:t("f941"),alt:""}})])}],v={},_=v,w=(t("d3b2"),Object(d["a"])(_,y,j,!1,null,"7063587f",null)),k=w.exports,C=[{name:"HomePage",path:"",component:()=>t.e("chunk-5fcbbc7e").then(t.bind(null,"408a")),meta:{title:"首页"}},{name:"About",path:"/about",component:()=>t.e("chunk-2d0d6561").then(t.bind(null,"71b3")),meta:{title:"关于我"}},{name:"Blog",path:"/blog",redirect:"/blog/home",component:()=>t.e("chunk-26008e92").then(t.bind(null,"5330")),children:[{name:"BlogHome",path:"home",component:()=>t.e("chunk-52f80f1c").then(t.bind(null,"77a4")),meta:{title:"博客"}},{name:"BlogAbout",path:"about",component:()=>t.e("chunk-0b374aa2").then(t.bind(null,"bb55"))},{name:"BlogArticle",path:"article",component:()=>t.e("chunk-05050cca").then(t.bind(null,"de45"))},{name:"CategoryBlogArticle",path:"/article/cate/:categoryId",component:()=>t.e("chunk-05050cca").then(t.bind(null,"de45"))},{name:"BlogDetail",path:"/article/:id",component:()=>t.e("chunk-529dd1de").then(t.bind(null,"5a47"))},{name:"BlogProject",path:"project",component:()=>t.e("chunk-27a975d0").then(t.bind(null,"53c0"))},{name:"BlogMessage",path:"message",component:()=>t.e("chunk-e4cda8ea").then(t.bind(null,"0aab"))}]},{name:"Essay",path:"/essay",component:()=>t.e("chunk-2d0a4d73").then(t.bind(null,"07c9")),meta:{title:"随记"}},{name:"WishingWall",path:"/wishing",component:()=>t.e("chunk-5190cc94").then(t.bind(null,"0613")),meta:{title:"许愿墙"}},{name:"NotFound",path:"*",component:k}],A=t("ed08");a["a"].use(b["a"]);const O=new b["a"]({mode:"history",routes:C,base:"/"});O.afterEach((e,n)=>{e.meta.title&&A["d"].setRouteTitle(e.meta.title)});var T=O,x=t("2f62"),S=t("ce03");async function q(){return await S["a"].get("/api/banner")}var z={namespaced:!0,state:{loading:!1,data:[]},mutations:{setLoading(e,n){e.loading=n},setData(e,n){e.data=n}},actions:{async fetchBanner(e){if(e.state.data.length)return;e.commit("setLoading",!0);const n=await q();e.commit("setData",n),e.commit("setLoading",!1)}}};async function D(){return await S["a"].get("/api/setting")}var P={namespaced:!0,state:{loading:!1,data:null},mutations:{setLoading(e,n){e.loading=n},setData(e,n){e.data=n}},actions:{async fetchSetting(e){e.commit("setLoading",!0);const n=await D();e.commit("setData",n),e.commit("setLoading",!1),n.siteTitle&&A["d"].setSiteTitle(n.siteTitle)}}};async function L(){return await S["a"].get("/api/about")}var M={namespaced:!0,state:{loading:!1,data:""},mutations:{setLoading(e,n){e.loading=n},setData(e,n){e.data=n}},actions:{async fetchAbout(e){if(e.state.data)return;e.commit("setLoading",!0);const n=await L();e.commit("setData",n),e.commit("setLoading",!1)}}};async function H(){return await S["a"].get("/api/project")}var E={namespaced:!0,state:{loading:!1,data:[]},mutations:{setLoading(e,n){e.loading=n},setData(e,n){e.data=n}},actions:{async fetchProject(e){if(e.state.data.length)return;e.commit("setLoading",!0);const n=await H();e.commit("setData",n),e.commit("setLoading",!1)}}};a["a"].use(x["a"]);var N=new x["a"].Store({modules:{banner:z,setting:P,about:M,project:E},strict:!0}),$=(t("8e1f"),t("02e6"),t("d010")),F=function(){var e=this,n=e._self._c;return n("img",{staticClass:"avatar-container",style:{width:e.size+"px",height:e.size+"px"},attrs:{src:e.url,alt:""}})},R=[],B={name:"Avatar",props:{url:{type:String,required:!0},size:{type:Number,default:100}}},I=B,J=(t("9a36"),Object(d["a"])(I,F,R,!1,null,"d43aee3c",null)),W=J.exports,G=t("96eb"),X=t.n(G);X.a.mock("/api/banner","get",{code:0,message:"",data:[{id:"1",midImg:"http://mdrs.yuanjin.tech/img/20201031141507.jpg",bigImg:"http://mdrs.yuanjin.tech/img/20201031141350.jpg",title:"凛冬将至",description:"人唯有恐惧的时候方能勇敢"},{id:"2",midImg:"http://mdrs.yuanjin.tech/img/20201031205550.jpg",bigImg:"http://mdrs.yuanjin.tech/img/20201031205551.jpg",title:"血火同源",description:"如果我回头，一切都完了"},{id:"3",midImg:"http://mdrs.yuanjin.tech/img/20201031204401.jpg",bigImg:"http://mdrs.yuanjin.tech/img/20201031204403.jpg",title:"听我怒吼",description:"兰尼斯特有债必偿"}]});var K=t("b383"),Q=t.n(K);X.a.mock("/api/blogtype","get",{code:0,msg:"","data|10-20":[{"id|+1":1,name:"分类@id","articleCount|0-300":0,"order|+1":1}]}),X.a.mock(/^\/api\/blog(\?.+)?$/,"get",(function(e){const n=Q.a.parse(e.url);return X.a.mock({code:0,msg:"",data:{"total|2000-3000":0,["rows|"+(n.limit||10)]:[{id:"@guid",title:"@ctitle(1, 50)",description:"@cparagraph(1, 10)",category:{"id|1-10":0,name:"分类@id"},"scanNumber|0-3000":0,"commentNumber|0-300":30,"thumb|1":["@image(300x250, @color, #fff, @natural)"],createDate:"@date('T')"}]}})})),X.a.mock(/^\/api\/blog\/[^/]+$/,"get",{code:0,msg:"",data:{id:"@guid",title:"CORS跨域方案详解",category:{"id|1-10":1,name:"分类@id"},description:"@cparagraph(1, 10)","scanNumber|0-10000":0,"commentNumber|0-100":0,createDate:"@date('T')",toc:[{name:"概述",anchor:"article-md-title-1"},{name:"简单请求",anchor:"article-md-title-2",children:[{name:"简单请求的判定",anchor:"article-md-title-3"},{name:"简单请求的交互规范",anchor:"article-md-title-4"}]},{name:"需要预检的请求",anchor:"article-md-title-5"},{name:"附带身份凭证的请求",anchor:"article-md-title-6"},{name:"一个额外的补充",anchor:"article-md-title-7"}],"thumb|1":[X.a.Random.image("300x250","#000","#fff","Random Image"),null],htmlContent:'<blockquote>\n  <p>阅读本文，你需要首先知道：</p><ol>\n  <li>浏览器的同源策略</li>\n  <li>跨域问题</li>\n  <li>JSONP原理</li>\n  <li>cookie原理</li>\n  </ol>\n  </blockquote>\n  <p>JSONP并不是一个好的跨域解决方案，它至少有着下面两个严重问题：</p><ol>\n  <li><strong>会打乱服务器的消息格式</strong>：JSONP要求服务器响应一段JS代码，但在非跨域的情况下，服务器又需要响应一个正常的JSON格式</li>\n  <li><strong>只能完成GET请求</strong>：JSONP的原理会要求浏览器端生成一个<code>script</code>元素，而<code>script</code>元素发出的请求只能是<code>get</code>请求</li>\n  </ol>\n  <p>所以，CORS是一种更好的跨域解决方案。</p><h1 id="article-md-title-1">概述</h1><p><code>CORS</code>是基于<code>http1.1</code>的一种跨域解决方案，它的全称是<strong>C</strong>ross-<strong>O</strong>rigin <strong>R</strong>esource <strong>S</strong>haring，跨域资源共享。</p><p>它的总体思路是：<strong>如果浏览器要跨域访问服务器的资源，需要获得服务器的允许</strong></p><figure class="markdown-image">\n\n        <img style="width:auto" src="http://mdrs.yuanjin.tech/img/image-20200421152122793.png" title="image-20200421152122793" alt="image-20200421152122793">\n        <figcaption>image-20200421152122793</figcaption>\n\n      </figure><p>而要知道，一个请求可以附带很多信息，从而会对服务器造成不同程度的影响</p><p>比如有的请求只是获取一些新闻，有的请求会改动服务器的数据</p><p>针对不同的请求，CORS规定了三种不同的交互模式，分别是：</p><ul>\n  <li><strong>简单请求</strong></li>\n  <li><strong>需要预检的请求</strong></li>\n  <li><strong>附带身份凭证的请求</strong></li>\n  </ul>\n  <p>这三种模式从上到下层层递进，请求可以做的事越来越多，要求也越来越严格。</p><p>下面分别说明三种请求模式的具体规范。</p><h1 id="article-md-title-2">简单请求</h1><p>当浏览器端运行了一段ajax代码（无论是使用XMLHttpRequest还是fetch api），浏览器会首先判断它属于哪一种请求模式</p><h2 id="article-md-title-3">简单请求的判定</h2><p>当请求<strong>同时满足</strong>以下条件时，浏览器会认为它是一个简单请求：</p><ol>\n  <li><p><strong>请求方法属于下面的一种：</strong></p><ul>\n  <li>get</li>\n  <li>post</li>\n  <li>head</li>\n  </ul>\n  </li>\n  <li><p><strong>请求头仅包含安全的字段，常见的安全字段如下：</strong></p><ul>\n  <li><code>Accept</code></li>\n  <li><code>Accept-Language</code></li>\n  <li><code>Content-Language</code></li>\n  <li><code>Content-Type</code></li>\n  <li><code>DPR</code></li>\n  <li><code>Downlink</code></li>\n  <li><code>Save-Data</code></li>\n  <li><code>Viewport-Width</code></li>\n  <li><code>Width</code></li>\n  </ul>\n  </li>\n  <li><p><strong>请求头如果包含<code>Content-Type</code>，仅限下面的值之一：</strong></p><ul>\n  <li><code>text/plain</code></li>\n  <li><code>multipart/form-data</code></li>\n  <li><code>application/x-www-form-urlencoded</code></li>\n  </ul>\n  </li>\n  </ol>\n  <p>如果以上三个条件同时满足，浏览器判定为简单请求。</p><p>下面是一些例子：</p><pre><code class="language-js"><span class="hljs-comment">// 简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>);\n\n  <span class="hljs-comment">// 请求方法不满足要求，不是简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>, {\n    <span class="hljs-attr">method</span>:<span class="hljs-string">"PUT"</span>\n  })\n\n  <span class="hljs-comment">// 加入了额外的请求头，不是简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>, {\n    <span class="hljs-attr">headers</span>:{\n      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>\n    }\n  })\n\n  <span class="hljs-comment">// 简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>, {\n    <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>\n  })\n\n  <span class="hljs-comment">// content-type不满足要求，不是简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>, {\n    <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>,\n    <span class="hljs-attr">headers</span>: {\n      <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>\n    }\n  })</code></pre>\n  <h2 id="article-md-title-4">简单请求的交互规范</h2><p>当浏览器判定某个<strong>ajax跨域请求</strong>是<strong>简单请求</strong>时，会发生以下的事情</p><ol>\n  <li><strong>请求头中会自动添加<code>Origin</code>字段</strong></li>\n  </ol>\n  <p>比如，在页面<code>http://my.com/index.html</code>中有以下代码造成了跨域</p><pre><code class="language-js"><span class="hljs-comment">// 简单请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/news"</span>);</code></pre>\n  <p>请求发出后，请求头会是下面的格式：</p><pre><code>GET /api/news/ HTTP/1.1\n  Host: crossdomain.com\n  Connection: keep-alive\n  ...\n  Referer: http://my.com/index.html\n  Origin: http://my.com</code></pre><p>看到最后一行没，<code>Origin</code>字段会告诉服务器，是哪个源地址在跨域请求</p><ol start="2">\n  <li><strong>服务器响应头中应包含<code>Access-Control-Allow-Origin</code></strong></li>\n  </ol>\n  <p>当服务器收到请求后，如果允许该请求跨域访问，需要在响应头中添加<code>Access-Control-Allow-Origin</code>字段</p><p>该字段的值可以是：</p><ul>\n  <li>*：表示我很开放，什么人我都允许访问</li>\n  <li>具体的源：比如<code>http://my.com</code>，表示我就允许你访问</li>\n  </ul>\n  <blockquote>\n  <p>实际上，这两个值对于客户端<code>http://my.com</code>而言，都一样，因为客户端才不会管其他源服务器允不允许，就关心自己是否被允许</p><p>当然，服务器也可以维护一个可被允许的源列表，如果请求的<code>Origin</code>命中该列表，才响应<code>*</code>或具体的源</p><p><strong>为了避免后续的麻烦，强烈推荐响应具体的源</strong></p></blockquote>\n  <p>假设服务器做出了以下的响应：</p><pre><code>HTTP/1.1 200 OK\n  Date: Tue, 21 Apr 2020 08:03:35 GMT\n  ...\n  Access-Control-Allow-Origin: http://my.com\n  ...\n\n  消息体中的数据</code></pre><p>当浏览器看到服务器允许自己访问后，高兴的像一个两百斤的孩子，于是，它就把响应顺利的交给js，以完成后续的操作</p><p>下图简述了整个交互过程</p><figure class="markdown-image">\n\n        <img style="width:auto" src="http://mdrs.yuanjin.tech/img/image-20200421162846480.png" title="image-20200421162846480" alt="image-20200421162846480">\n        <figcaption>image-20200421162846480</figcaption>\n\n      </figure><h1 id="article-md-title-5">需要预检的请求</h1><p>简单的请求对服务器的威胁不大，所以允许使用上述的简单交互即可完成。</p><p>但是，如果浏览器不认为这是一种简单请求，就会按照下面的流程进行：</p><ol>\n  <li><strong>浏览器发送预检请求，询问服务器是否允许</strong></li>\n  <li><strong>服务器允许</strong></li>\n  <li><strong>浏览器发送真实请求</strong></li>\n  <li><strong>服务器完成真实的响应</strong></li>\n  </ol>\n  <p>比如，在页面<code>http://my.com/index.html</code>中有以下代码造成了跨域</p><pre><code class="language-js"><span class="hljs-comment">// 需要预检的请求</span>\n  fetch(<span class="hljs-string">"http://crossdomain.com/api/user"</span>, {\n    <span class="hljs-attr">method</span>:<span class="hljs-string">"POST"</span>, <span class="hljs-comment">// post 请求</span>\n    <span class="hljs-attr">headers</span>:{  <span class="hljs-comment">// 设置请求头</span>\n      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,\n      <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,\n      <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>\n    },\n    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({ <span class="hljs-attr">name</span>: <span class="hljs-string">"袁小进"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> }) <span class="hljs-comment">// 设置请求体</span>\n  });</code></pre>\n  <p>浏览器发现它不是一个简单请求，则会按照下面的流程与服务器交互</p><ol>\n  <li><strong>浏览器发送预检请求，询问服务器是否允许</strong></li>\n  </ol>\n  <pre><code>OPTIONS /api/user HTTP/1.1\n  Host: crossdomain.com\n  ...\n  Origin: http://my.com\n  Access-Control-Request-Method: POST\n  Access-Control-Request-Headers: a, b, content-type</code></pre><p>可以看出，这并非我们想要发出的真实请求，请求中不包含我们的响应头，也没有消息体。</p><p>这是一个预检请求，它的目的是询问服务器，是否允许后续的真实请求。</p><p>预检请求<strong>没有请求体</strong>，它包含了后续真实请求要做的事情</p><p>预检请求有以下特征：</p><ul>\n  <li>请求方法为<code>OPTIONS</code></li>\n  <li>没有请求体</li>\n  <li>请求头中包含<ul>\n  <li><code>Origin</code>：请求的源，和简单请求的含义一致</li>\n  <li><code>Access-Control-Request-Method</code>：后续的真实请求将使用的请求方法</li>\n  <li><code>Access-Control-Request-Headers</code>：后续的真实请求会改动的请求头</li>\n  </ul>\n  </li>\n  </ul>\n  <ol start="2">\n  <li><strong>服务器允许</strong></li>\n  </ol>\n  <p>服务器收到预检请求后，可以检查预检请求中包含的信息，如果允许这样的请求，需要响应下面的消息格式</p><pre><code>HTTP/1.1 200 OK\n  Date: Tue, 21 Apr 2020 08:03:35 GMT\n  ...\n  Access-Control-Allow-Origin: http://my.com\n  Access-Control-Allow-Methods: POST\n  Access-Control-Allow-Headers: a, b, content-type\n  Access-Control-Max-Age: 86400\n  ...</code></pre><p>对于预检请求，不需要响应任何的消息体，只需要在响应头中添加：</p><ul>\n  <li><code>Access-Control-Allow-Origin</code>：和简单请求一样，表示允许的源</li>\n  <li><code>Access-Control-Allow-Methods</code>：表示允许的后续真实的请求方法</li>\n  <li><code>Access-Control-Allow-Headers</code>：表示允许改动的请求头</li>\n  <li><code>Access-Control-Max-Age</code>：告诉浏览器，多少秒内，对于同样的请求源、方法、头，都不需要再发送预检请求了</li>\n  </ul>\n  <ol start="3">\n  <li><strong>浏览器发送真实请求</strong></li>\n  </ol>\n  <p>预检被服务器允许后，浏览器就会发送真实请求了，上面的代码会发生下面的请求数据</p><pre><code>POST /api/user HTTP/1.1\n  Host: crossdomain.com\n  Connection: keep-alive\n  ...\n  Referer: http://my.com/index.html\n  Origin: http://my.com\n\n  {"name": "袁小进", "age": 18 }</code></pre><ol start="4">\n  <li><strong>服务器响应真实请求</strong></li>\n  </ol>\n  <pre><code>HTTP/1.1 200 OK\n  Date: Tue, 21 Apr 2020 08:03:35 GMT\n  ...\n  Access-Control-Allow-Origin: http://my.com\n  ...\n\n  添加用户成功</code></pre><p>可以看出，当完成预检之后，后续的处理与简单请求相同</p><p>下图简述了整个交互过程</p><figure class="markdown-image">\n\n        <img style="width:auto" src="http://mdrs.yuanjin.tech/img/image-20200421165913320.png" title="image-20200421165913320" alt="image-20200421165913320">\n        <figcaption>image-20200421165913320</figcaption>\n\n      </figure><h1 id="article-md-title-6">附带身份凭证的请求</h1><p>默认情况下，ajax的跨域请求并不会附带cookie，这样一来，某些需要权限的操作就无法进行</p><p>不过可以通过简单的配置就可以实现附带cookie</p><pre><code class="language-js"><span class="hljs-comment">// xhr</span>\n  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();\n  xhr.withCredentials = <span class="hljs-literal">true</span>;\n\n  <span class="hljs-comment">// fetch api</span>\n  fetch(url, {\n    <span class="hljs-attr">credentials</span>: <span class="hljs-string">"include"</span>\n  })</code></pre>\n  <p>这样一来，该跨域的ajax请求就是一个<em>附带身份凭证的请求</em></p><p>当一个请求需要附带cookie时，无论它是简单请求，还是预检请求，都会在请求头中添加<code>cookie</code>字段</p><p>而服务器响应时，需要明确告知客户端：服务器允许这样的凭据</p><p>告知的方式也非常的简单，只需要在响应头中添加：<code>Access-Control-Allow-Credentials: true</code>即可</p><p>对于一个附带身份凭证的请求，若服务器没有明确告知，浏览器仍然视为跨域被拒绝。</p><p>另外要特别注意的是：<strong>对于附带身份凭证的请求，服务器不得设置 <code>Access-Control-Allow-Origin 的值为*</code></strong>。这就是为什么不推荐使用*的原因</p><h1 id="article-md-title-7">一个额外的补充</h1><p>在跨域访问时，JS只能拿到一些最基本的响应头，如：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，则需要服务器设置本响应头。</p><p><code>Access-Control-Expose-Headers</code>头让服务器把允许浏览器访问的头放入白名单，例如：</p><pre><code>Access-Control-Expose-Headers: authorization, a, b</code></pre><p>这样JS就能够访问指定的响应头了。</p>'}}),X.a.mock("/api/comment","post",{code:0,msg:"",data:{id:"@guid",nickname:"@cname",content:"@cparagraph(1, 10)",createDate:Date.now(),"avatar|1":["https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar6.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar4.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar8.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar2.jpg"]}}),X.a.mock(/^\/api\/comment\/?(\?.+)?$/,"get",(function(e){const n=Q.a.parse(e.url);return X.a.mock({code:0,msg:"",data:{"total|50-200":0,["rows|"+(n.limit||10)]:[{id:"@guid",nickname:"@cname",content:"@cparagraph(1, 10)",createDate:Date.now(),"avatar|1":["https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar6.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar4.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar8.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar2.jpg"]}]}})})),X.a.mock("/api/setting","get",{code:0,msg:"",data:{avatar:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F4207fc45067832f6891ce50f87c42dee9dffa1a6331ae-ik8Tce_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652488019&t=59142e23d94e3b628e91f18d238ebd35",siteTitle:"DaLoong的博客",github:"https://github.com/CDaLoong",qq:"850122312",qqQrCode:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F4207fc45067832f6891ce50f87c42dee9dffa1a6331ae-ik8Tce_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652488019&t=59142e23d94e3b628e91f18d238ebd35",weixin:"CDaLoong",weixinQrCode:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F4207fc45067832f6891ce50f87c42dee9dffa1a6331ae-ik8Tce_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1652488019&t=59142e23d94e3b628e91f18d238ebd35",mail:"CDaLoong@gmail.com",icp:"鲁ICP备2021031333号",githubName:"CDaLoong",favicon:"http://mdrs.cdaloong.tech/Fs4CDlC6mwe_WXLMIiXcmSJLHO4f"}}),X.a.mock("/api/about","get",{code:0,msg:"",data:"https://www.wolai.com/8Ft8XpZ2r26M88yRMhE1TF"}),X.a.mock(/^\/api\/project\/?$/,"get",{code:0,msg:"","data|10-20":[{id:"@uuid",name:"@ctitle(1, 10)","url|1":["@url",null],"github|1":["@url",null],"description|1-4":["@cparagraph(1, 5)"],thumb:"@image(300x250, @color, #fff, @natural)"}]}),X.a.mock("/api/message","post",{code:0,msg:"",data:{id:"@guid",nickname:"@cname",content:"@cparagraph(1, 10)",createDate:Date.now(),"avatar|1":["https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar6.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar4.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar8.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar2.jpg"]}}),X.a.mock(/^\/api\/message\/?(\?.+)?$/,"get",(function(e){const n=Q.a.parse(e.url);return X.a.mock({code:0,msg:"",data:{total:52,["rows|"+(n.limit||10)]:[{id:"@guid",nickname:"@cname",content:"@cparagraph(1, 10)",createDate:Date.now(),"avatar|1":["https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar6.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar4.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar8.jpg","https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar2.jpg"]}]}})})),X.a.setup({timeout:"500-1000"});const U=new a["a"]({});a["a"].prototype.$bus=U;var Y=U,Z=t("c4f5"),V=t("47dc"),ee=t.n(V),ne=t("7c05"),te=t.n(ne);function ae(e){return e.querySelector("img[data-role=loading]")}function oe(){const e=document.createElement("img");return e.dataset.role="loading",e.src=ee.a,e.className=te.a.loading,e}var se=function(e,n){const t=ae(e);if(n.value){if(!t){const n=oe();e.appendChild(n)}}else t&&t.remove()},ce=(t("14d9"),t("b695")),ie=t.n(ce);let le=[];function re(e){e.dom.src=ie.a;const n=document.documentElement.clientHeight,t=e.dom.getBoundingClientRect(),a=t.height||150;if(t.top>=-a&&t.top<=n){const n=new Image;n.onload=function(){e.dom.src=e.src},n.src=e.src,le=le.filter(n=>n!==e)}}function de(){for(const e of le)re(e)}function pe(){de()}Y.$on("mainScroll",Object(A["a"])(pe,50));var me={inserted(e,n){const t={dom:e,src:n.value};le.push(t),re(t)},unbind(e){le=le.filter(n=>n.dom!==e)}};a["a"].config.productionTip=!1,a["a"].component($["a"].name,$["a"]),a["a"].component(W.name,W),a["a"].prototype.$showMessage=Z["a"],a["a"].directive("loading",se),a["a"].directive("lazy",me),N.dispatch("setting/fetchSetting"),new a["a"]({router:T,store:N,render:e=>e(f)}).$mount("#app")},"632b":function(e,n,t){},6893:function(e,n,t){"use strict";t("e0a7")},"6ffb":function(e,n,t){e.exports={message:"showMessage-module_message_A0Dqf","message-info":"showMessage-module_message-info_2wE0r","message-success":"showMessage-module_message-success_1lRXY","message-warn":"showMessage-module_message-warn_3Jfai","message-error":"showMessage-module_message-error_qMZGd",icon:"showMessage-module_icon_QhqPn"}},"7c05":function(e,n,t){e.exports={loading:"loading-module_loading_eIAKe"}},"8e1f":function(e,n,t){},"9a36":function(e,n,t){"use strict";t("1435")},b695:function(e,n,t){e.exports=t.p+"img/default.969421d9.gif"},c4f5:function(e,n,t){"use strict";var a=t("dc93"),o=t("6ffb"),s=t.n(o),c=t("d010");n["a"]=function(e={}){const n=e.content||"",t=e.type||"info",o=e.duration||2e3,i=e.container||document.body,l=document.createElement("div"),r=Object(a["a"])(c["a"],{type:t});l.innerHTML=`<span class="${s.a.icon}">${r.outerHTML}</span><div>${n}</div>`;const d=s.a["message-"+t];l.className=`${s.a.message} ${d}`,"static"===getComputedStyle(i).position&&(i.style.position="relative"),i.appendChild(l),l.clientHeight,l.style.opacity=1,l.style.transform="translate(-50%, -50%)",setTimeout(()=>{l.style.opacity=0,l.style.transform="translate(-50%, -50%) translateY(-25px)",l.addEventListener("transitionend",(function(){l.remove(),e.callback&&e.callback()}),{once:!0})},o)}},ce03:function(e,n,t){"use strict";var a=t("bc3a"),o=t.n(a),s=t("c4f5");const c=o.a.create();c.interceptors.response.use((function(e){return 0!==e.data.code?(Object(s["a"])({content:e.data.msg,type:"error",duration:1500}),null):e.data.data})),n["a"]=c},d010:function(e,n,t){"use strict";var a=function(){var e=this,n=e._self._c;return n("i",{staticClass:"iconfont icon-container",class:e.fontClass})},o=[];const s=[{icon_id:"405747",name:"wechat",font_class:"icon-weixin",unicode:"e6b1",unicode_decimal:59057},{icon_id:"604660",name:"home",font_class:"icon-zhuye",unicode:"e635",unicode_decimal:58933},{icon_id:"1019955",name:"message",font_class:"icon-mes",unicode:"e626",unicode_decimal:58918},{icon_id:"1227534",name:"note",font_class:"icon-liuyan",unicode:"e639",unicode_decimal:58937},{icon_id:"2674878",name:"arrowsUp",font_class:"icon-jiantoushang",unicode:"e62c",unicode_decimal:58924},{icon_id:"2674929",name:"arrowsDown",font_class:"icon-jiantouxia",unicode:"e62d",unicode_decimal:58925},{icon_id:"3051174",name:"success",font_class:"icon-zhengque1",unicode:"e600",unicode_decimal:58880},{icon_id:"8017484",name:"empty",font_class:"icon-empty",unicode:"e6a6",unicode_decimal:59046},{icon_id:"9974756",name:"close",font_class:"icon-guanbi",unicode:"e710",unicode_decimal:59152},{icon_id:"12148932",name:"error",font_class:"icon-cuowu",unicode:"e7fa",unicode_decimal:59386},{icon_id:"12443502",name:"qq",font_class:"icon-sign_qq",unicode:"e637",unicode_decimal:58935},{icon_id:"12579639",name:"blog",font_class:"icon-blog",unicode:"e7c6",unicode_decimal:59334},{icon_id:"13998420",name:"about",font_class:"icon-set_about_hov",unicode:"e688",unicode_decimal:59016},{icon_id:"18226383",name:"code",font_class:"icon-code",unicode:"e61e",unicode_decimal:58910},{icon_id:"18706452",name:"email",font_class:"icon-Emailus",unicode:"e636",unicode_decimal:58934},{icon_id:"19450584",name:"github",font_class:"icon-github-fill",unicode:"eac8",unicode_decimal:60104},{icon_id:"22553270",name:"warn",font_class:"icon-a-ziyuan35",unicode:"e60c",unicode_decimal:58892},{icon_id:"12473808",name:"list",font_class:"icon-liebiao",unicode:"e61f",unicode_decimal:58911},{icon_id:"736792",name:"info",font_class:"icon-info",unicode:"e6d0",unicode_decimal:59088}];var c={name:"Icon",props:{type:{type:String,required:!0}},computed:{fontClass(){return s.find(e=>this.type===e.name).font_class}}},i=c,l=(t("55a8"),t("2877")),r=Object(l["a"])(i,a,o,!1,null,"7371e123",null);n["a"]=r.exports},d3b2:function(e,n,t){"use strict";t("399e")},dc93:function(e,n,t){"use strict";var a=t("2b0e");n["a"]=function(e,n){const t=new a["a"]({render:t=>t(e,{props:n})});return t.$mount(),t.$el}},e0a7:function(e,n,t){},ed08:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"a",(function(){return o})),t.d(n,"d",(function(){return l})),t.d(n,"c",(function(){return r}));t("c4f5"),t("dc93");var a=function(e){const n=new Date(+e),t=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${n.getFullYear()}-${t}-${a}`},o=function(e,n=100){let t=null;return(...a)=>{clearTimeout(t),t=setTimeout(()=>{e(...a)},n)}};let s="",c="";function i(){document.title=s||c?s&&!c?s:!s&&c?c:`${s}-${c}`:"loading..."}var l={setRouteTitle(e){s=e,i()},setSiteTitle(e){c=e,i()}};const r=(e,n)=>Math.floor(Math.random()*(e-n+1)+n)},f941:function(e,n,t){e.exports=t.p+"img/404.5b8a38c7.jpg"}});
//# sourceMappingURL=app.cdc784cb.js.map